<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.salesMapper">

	<!-- 수주 등록_TransactionVO -->
	<insert id="salesOrderAdd_TransactionVO" useGeneratedKeys="true" keyProperty="tran_num">
		insert into transaction(tran_num, cli_num, pic_username, tran_date, ex_due_date, pro_status, tran_cate_code, comm)
		values(#{tran_num}, #{cli_num}, #{pic_username}, #{tran_date}, #{ex_due_date}, "수주 접수" , #{tran_cate_code}, #{comm})
	</insert>

	<!-- 수주 등록_TransactionGoodsVO -->
	<insert id="salesOrderAdd_TransactionGoodsVO">
		insert into transaction_goods(tran_num, goods_num, goods_qty)
		values((select tran_num from transaction where tran_id = #{tran_num}), #{goods_num}, #{goods_qty})
	</insert>

	<!-- tran_num 출력 -->
	<select id="getTranNum" resultType="String">
		<![CDATA[
			select DISTINCT CONCAT(#{tran_cate_code}, LPAD(MAX(CAST(SUBSTRING(tran_num, 3) AS UNSIGNED)) + 1, 3, '0')) from transaction
		]]>
	</select>





</mapper>